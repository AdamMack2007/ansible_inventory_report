- name: Gather ASA Facts
  asa_command:
    commands:
      - show hostname
      - show version | i Software Version
      - sh version | i Hardware
      - show version | i Serial Number
  register: asa_vars

- name: Set ASA Facts
  set_fact:
    ansible_net_hostname: "{{ asa_vars.stdout[0] }}"
    ansible_net_version: "{{ asa_vars.stdout[1].split(' ')[6] }}"
    ansible_net_model: "{{ asa_vars.stdout[2].split(':')[1].split(',')[0] }}"
    ansible_net_serialnum: "{{ asa_vars.stdout[3].split(':')[1] }}"
    desired_version: "{{ desired_version }}"
    cacheable: yes

- name: Get Existing NTP Servers
  asa_command:
    commands: "sh run | i ntp server"
  register: current_ntp

- name: Get Existing Syslog Servers
  asa_command:
    commands: "sh run | i logging host"
  register: current_syslog

- name: Get Existing AAA Servers
  asa_command:
    commands: "sh run aaa"
  register: current_aaa

- name: Create list of current servers
  set_fact:
    existing_ntp: "{{ current_ntp.stdout[0] | regex_findall('\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b') }}"
    existing_syslog: "{{ current_syslog.stdout[0] | regex_findall('\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b') }}"
    existing_aaa: "{{ current_aaa.stdout[0] | regex_findall('\\b(?:[0-9]{1,3}\\.){3}[0-9]{1,3}\\b') }}"
